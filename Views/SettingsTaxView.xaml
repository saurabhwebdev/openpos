<UserControl x:Class="MyWinFormsApp.Views.SettingsTaxView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Margin="40,24,40,40">

            <!-- Info Banner -->
            <materialDesign:Card Padding="16" UniformCornerRadius="12" Margin="0,0,0,16"
                                 Background="{DynamicResource PrimaryHueLightBrush}">
                <DockPanel>
                    <materialDesign:PackIcon Kind="InformationOutline" Width="24" Height="24"
                                              DockPanel.Dock="Left" VerticalAlignment="Center" Margin="0,0,12,0"
                                              Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock x:Name="TxtCountryInfo" FontSize="14" FontWeight="Medium"
                                   Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                        <TextBlock Text="Tax rates are based on your business country set in Business Details. These will be used for invoices and billing."
                                   FontSize="12" Opacity="0.8" TextWrapping="Wrap"
                                   Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                    </StackPanel>
                </DockPanel>
            </materialDesign:Card>

            <!-- Tax Slabs Card -->
            <materialDesign:Card Padding="24" UniformCornerRadius="12" Margin="0,0,0,16">
                <StackPanel>
                    <DockPanel Margin="0,0,0,16">
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                            <materialDesign:PackIcon Kind="ReceiptTextOutline" Width="20" Height="20"
                                                      VerticalAlignment="Center" Margin="0,0,10,0" Opacity="0.7"/>
                            <TextBlock Text="Tax Slabs"
                                       Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        <Button x:Name="BtnAddTax" Style="{StaticResource MaterialDesignFlatButton}"
                                HorizontalAlignment="Right" Click="BtnAddTax_Click">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Plus" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <TextBlock Text="Add Tax Slab" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </DockPanel>

                    <!-- Tax Slabs List -->
                    <ItemsControl x:Name="TaxList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,0,0,1"
                                        Padding="0,10,0,10">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="160"/>
                                            <ColumnDefinition Width="70"/>
                                            <ColumnDefinition Width="70"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Tax Name + Description -->
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding TaxName}" FontSize="14" FontWeight="Medium"/>
                                            <TextBlock Text="{Binding Description}" FontSize="11" Opacity="0.5"/>
                                        </StackPanel>

                                        <!-- Rate -->
                                        <TextBlock Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center"
                                                   FontSize="14" FontWeight="SemiBold">
                                            <Run Text="{Binding Rate, StringFormat={}{0:0.##}}"/><Run Text="%"/>
                                        </TextBlock>

                                        <!-- Components -->
                                        <TextBlock Grid.Column="2" Text="{Binding ComponentsDisplay}" VerticalAlignment="Center"
                                                   HorizontalAlignment="Center" FontSize="12" Opacity="0.6"/>

                                        <!-- Default badge -->
                                        <Border Grid.Column="3" VerticalAlignment="Center" HorizontalAlignment="Center"
                                                Background="{DynamicResource PrimaryHueLightBrush}"
                                                CornerRadius="4" Padding="6,2"
                                                Visibility="{Binding IsDefault, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="Default" FontSize="10"
                                                       Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                        </Border>

                                        <!-- Active indicator -->
                                        <Ellipse Grid.Column="4" Width="10" Height="10"
                                                 VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <Ellipse.Style>
                                                <Style TargetType="Ellipse">
                                                    <Setter Property="Fill" Value="#4CAF50"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsActive}" Value="False">
                                                            <Setter Property="Fill" Value="#9E9E9E"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Ellipse.Style>
                                        </Ellipse>

                                        <!-- Actions -->
                                        <StackPanel Grid.Column="5" Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Style="{StaticResource MaterialDesignIconForegroundButton}"
                                                    ToolTip="Edit" Click="BtnEditTax_Click"
                                                    Tag="{Binding Id}" Padding="4" Height="30" Width="30">
                                                <materialDesign:PackIcon Kind="Pencil" Width="16" Height="16"/>
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignIconForegroundButton}"
                                                    ToolTip="Delete" Click="BtnDeleteTax_Click"
                                                    Tag="{Binding Id}" Padding="4" Height="30" Width="30"
                                                    Foreground="#F44336">
                                                <materialDesign:PackIcon Kind="Delete" Width="16" Height="16"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <ProgressBar x:Name="ProgressLoad"
                                 Style="{StaticResource MaterialDesignCircularProgressBar}"
                                 IsIndeterminate="True" Visibility="Collapsed"
                                 HorizontalAlignment="Center" Margin="0,20,0,0"
                                 Width="32" Height="32"/>

                    <TextBlock x:Name="TxtEmptyMessage"
                               Text="No tax slabs configured. Click 'Add Tax Slab' to create one."
                               FontSize="12" Opacity="0.5" TextAlignment="Center"
                               Margin="0,20,0,0" Visibility="Collapsed"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Add/Edit Tax Card (hidden by default) -->
            <materialDesign:Card x:Name="CardEditTax" Padding="24" UniformCornerRadius="12"
                                 Visibility="Collapsed" Margin="0,0,0,16">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <materialDesign:PackIcon Kind="Pencil" Width="20" Height="20"
                                                  VerticalAlignment="Center" Margin="0,0,10,0" Opacity="0.7"/>
                        <TextBlock x:Name="TxtEditTitle" Text="Add Tax Slab"
                                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"/>
                    </StackPanel>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBox x:Name="TxtTaxName" Grid.Row="0" Grid.Column="0"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Tax Name (e.g. GST 18%)"
                                 FontSize="14" Margin="0,0,0,12"/>

                        <TextBox x:Name="TxtTaxType" Grid.Row="0" Grid.Column="2"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Tax Type (e.g. CGST+SGST, VAT)"
                                 FontSize="14" Margin="0,0,0,12"/>

                        <TextBox x:Name="TxtRate" Grid.Row="1" Grid.Column="0"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Total Rate %"
                                 FontSize="14" Margin="0,0,0,12"/>

                        <TextBox x:Name="TxtSortOrder" Grid.Row="1" Grid.Column="2"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Sort Order"
                                 FontSize="14" Margin="0,0,0,12" Text="0"/>

                        <TextBox x:Name="TxtComponent1Name" Grid.Row="2" Grid.Column="0"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Component 1 Name (e.g. CGST)"
                                 FontSize="14" Margin="0,0,0,12"/>

                        <TextBox x:Name="TxtComponent1Rate" Grid.Row="2" Grid.Column="2"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Component 1 Rate %"
                                 FontSize="14" Margin="0,0,0,12"/>

                        <TextBox x:Name="TxtComponent2Name" Grid.Row="3" Grid.Column="0"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Component 2 Name (e.g. SGST)"
                                 FontSize="14" Margin="0,0,0,12"/>

                        <TextBox x:Name="TxtComponent2Rate" Grid.Row="3" Grid.Column="2"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Component 2 Rate %"
                                 FontSize="14" Margin="0,0,0,12"/>
                    </Grid>

                    <TextBox x:Name="TxtDescription"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             materialDesign:HintAssist.Hint="Description (optional)"
                             FontSize="14" Margin="0,0,0,12" TextWrapping="Wrap"
                             MinHeight="50" AcceptsReturn="True"/>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <CheckBox x:Name="ChkIsDefault" Content="Set as default tax"
                                  Style="{StaticResource MaterialDesignCheckBox}"
                                  Margin="0,0,24,0"/>
                        <CheckBox x:Name="ChkIsActive" Content="Active" IsChecked="True"
                                  Style="{StaticResource MaterialDesignCheckBox}"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal">
                        <Button x:Name="BtnSaveTax"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Click="BtnSaveTax_Click" Margin="0,0,12,0" Height="40">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ContentSave" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="SAVE" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="BtnCancelEdit"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Click="BtnCancelEdit_Click" Height="40">
                            <TextBlock Text="CANCEL"/>
                        </Button>
                        <ProgressBar x:Name="ProgressSave"
                                     Style="{StaticResource MaterialDesignCircularProgressBar}"
                                     IsIndeterminate="True" Visibility="Collapsed"
                                     VerticalAlignment="Center" Width="28" Height="28" Margin="12,0,0,0"/>
                    </StackPanel>

                    <TextBlock x:Name="TxtMessage" FontSize="12"
                               TextWrapping="Wrap" Margin="0,12,0,0"
                               Visibility="Collapsed"/>
                </StackPanel>
            </materialDesign:Card>

        </StackPanel>
    </ScrollViewer>
</UserControl>
